let jsonUrl="https://kkapi.cqlkc.top/api/ispeak?author=633aaa45d0d52c818b1cf9c1&page=1";function bbtalk(){let t,e=JSON.parse(localStorage.getItem("bibi")),a=Date.now();if(null==e||a-e.time>=18e5)return void getData();t=JSON.parse(e.ls);let l="";t.forEach(((t,e)=>{t.content=t.content.replace(/[\s\uFEFF\xA0]+/g,"");let a=new Date(t.createdAt),i=a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds(),n=timeago.format(i,"zh_CN");l+='<li class="item item-'+(e+1)+'">'+('<span class="datatime">'+n+"</span>")+"： "+urlToLink(t.content)+"</li>"})),document.getElementById("bber-talk").innerHTML+='<i style="margin-right: 10px;" class="fa-regular fa-message"></i><ul class="talk-list">'+l+'</ul><i class="fa-solid fa-angles-right pass bber-icon"></i>'}function getData(){fetch(jsonUrl).then((t=>t.json())).then((t=>{t={time:Date.now(),ls:JSON.stringify(t.data.items)},localStorage.setItem("bibi",JSON.stringify(t))})).then((()=>{bbtalk()})).catch((()=>{console.log("获取哔哔数据失败！")}))}function urlToLink(t){return t=t.replace(/<img(.*?)src=[\"|\']?(.*?)[\"|\']?(.*?)>|!\[(.*?)\]\((.*?)\)/g,'<i class="fa-solid fa-image"></i>')}function Roll(){try{let t=Array.prototype.slice.call(document.querySelectorAll(".talk-list li")),e=t[0];t.splice(0,1),t.push(e);let a=document.querySelector("ul.talk-list");t.forEach((t=>{a.appendChild(t)}))}catch(t){}}document.getElementById("bber-talk").addEventListener("click",(()=>{pjax.loadUrl("/bbtalk/")})),bbtalk(),document.addEventListener("pjax:complete",(()=>{bbtalk()})),setInterval(Roll,3e3);